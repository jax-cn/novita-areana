# Novita Arena - ä½¿ç”¨æµç¨‹

**ç‰ˆæœ¬**: 1.2
**æœ€åæ›´æ–°**: 2025-01-17
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ

---

## ç›®å½•

1. [ä¸»æµç¨‹](#1-ä¸»æµç¨‹)
2. [ç”¨æˆ·ç™»å½•æµç¨‹](#2-ç”¨æˆ·ç™»å½•æµç¨‹)
3. [App ç”Ÿæˆæµç¨‹](#3-app-ç”Ÿæˆæµç¨‹)
4. [å½•å±ä¸Šä¼ æµç¨‹](#4-å½•å±ä¸Šä¼ æµç¨‹)
5. [åˆ†äº«éƒ¨ç½²æµç¨‹](#5-åˆ†äº«éƒ¨ç½²æµç¨‹)
6. [ç”»å»Šæµè§ˆæµç¨‹](#6-ç”»å»Šæµè§ˆæµç¨‹)
7. [æ ¸å¿ƒçŠ¶æ€æœº](#7-æ ¸å¿ƒçŠ¶æ€æœº)

---

## 1. ä¸»æµç¨‹

### 1.1 ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨
```
ç”¨æˆ·è¿›å…¥é¦–é¡µ â†’ æµè§ˆç”»å»Š â†’ é€‰æ‹©çµæ„Ÿ / è¾“å…¥ Prompt â†’ ç‚¹å‡»"å¼€å§‹ PK"
  â†’ è·³è½¬åˆ° Playground â†’ è‡ªåŠ¨å¡«å…… Prompt â†’ å¼€å§‹ç”Ÿæˆ
```

### 1.2 ç”¨æˆ·ç¬¬äºŒæ¬¡ä½¿ç”¨ï¼ˆIP åˆ¤æ–­ï¼‰
```
ç”¨æˆ·è¿›å…¥é¦–é¡µ â†’ è¾“å…¥ Prompt â†’ ç‚¹å‡»"å¼€å§‹ PK"
  â†’ åç«¯æ£€æŸ¥ IP é¢åº¦ â†’ å·²ä½¿ç”¨ â†’ å¼¹æ¡†æç¤ºï¼š
     "åªæœ‰ä¸€æ¬¡å…è´¹æœºä¼šï¼Œéœ€è¦ç™»å½•æ‰èƒ½ç»§ç»­"
  â†’ ç”¨æˆ·ç‚¹å‡»"å»ç™»å½•" â†’ è·³è½¬ç™»å½•é¡µé¢
```

### 1.3 å·²ç™»å½•ç”¨æˆ·
```
ç”¨æˆ·è¿›å…¥é¦–é¡µ â†’ æµè§ˆç”»å»Š â†’ ç‚¹å‡»"å¼€å§‹ PK"
  â†’ æ£€æŸ¥æ˜¯å¦å·²å¡« API Key â†’ æœªå¡« â†’ æ˜¾ç¤º Bannerï¼š
     "è¯·å¡«å†™ API Key æ‰èƒ½å¼€å§‹ç”Ÿæˆ"
  â†’ ç”¨æˆ·å¡«å†™ API Key â†’ å¼€å§‹ç”Ÿæˆ
```

---

## 2. ç”¨æˆ·ç™»å½•æµç¨‹

### 2.1 ç™»å½•è·³è½¬
```
ç”¨æˆ·ç‚¹å‡»ç™»å½• â†’ å­˜å½“å‰ URL åˆ° Cookie (redirect_url)
  â†’ è·³è½¬ https://api.novita.ai/login?redirect_url={domain}/api/auth
```

### 2.2 Novita å›è°ƒ
```
ç”¨æˆ·å®Œæˆç™»å½• â†’ è·³è½¬ novita.ai/api/auth â†’ Novita åç«¯ Set-Cookie
  â†’ 307 è·³è½¬åˆ° /api/auth
```

### 2.3 åç«¯å¤„ç†
```
/api/auth æ¥æ”¶è¯·æ±‚ â†’ è¯»å– Novita è®¾ç½®çš„ Cookie
  â†’ è°ƒç”¨ https://api-server.novita.ai/v1/user/info è·å–ç”¨æˆ·ä¿¡æ¯
  â†’ æå–å­—æ®µï¼šuuid, email, username, firstName, lastName, tier
  â†’ å­˜å‚¨åˆ° users è¡¨ â†’ è®¾ç½® Session (JWT)
  â†’ è¯»å– Cookie ä¸­çš„ redirect_url â†’ 307 è·³è½¬
```

### 2.4 API Key ç®¡ç†
```
ç”¨æˆ·ç™»å½•å â†’ é¦–æ¬¡ç”Ÿæˆ â†’ æ˜¾ç¤º Bannerï¼š"è¯·å¡«å†™ API Key"
  â†’ ç”¨æˆ·å¡«å†™ Keyï¼ˆnovita_key | claude_key | otherï¼‰
  â†’ POST /api/auth/save-api-key â†’ åç«¯ä¿å­˜åˆ° users.api_key
  â†’ éªŒè¯ Keyï¼ˆè°ƒç”¨ LLM API è¿”å›ä¸€ä¸ª Tokenï¼‰
  â†’ éªŒè¯æˆåŠŸ â†’ å…è®¸ç”Ÿæˆ
```

---

## 3. App ç”Ÿæˆæµç¨‹

### 3.1 åˆ›å»º Appï¼ˆåç«¯ï¼‰
```
POST /api/apps/create
  â†’ æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
  â†’ å¦‚æœæœªç™»å½• â†’ æ£€æŸ¥ IP é¢åº¦ (ip_usage è¡¨)
  â†’ å¦‚æœå·²ç™»å½• â†’ æ£€æŸ¥ users.api_key æ˜¯å¦å­˜åœ¨
  â†’ ç”Ÿæˆ app_id (UUID)
  â†’ è°ƒç”¨ Novita Sandbox API åˆ›å»º 2 ä¸ªå®ä¾‹
  â†’ è®°å½•åˆ° apps è¡¨ï¼ˆå­˜å‚¨ sandbox_id_a, sandbox_id_bï¼‰
  â†’ è¿”å› Sandbox æ•°æ®ç»“æ„ï¼š
     {
       app_id: "uuid",
       sandbox_a: { id, hostUrl, previewPort, servicePort },
       sandbox_b: { id, hostUrl, previewPort, servicePort }
     }
```

### 3.2 å¹¶è¡Œç”Ÿæˆï¼ˆå‰ç«¯ï¼‰
```
å‰ç«¯æ¥æ”¶ Sandbox URLs â†’ å¹¶è¡Œè°ƒç”¨ 2 ä¸ª Sandbox APIï¼š
  POST {sandbox_a.hostUrl}:{sandbox_a.servicePort}/generate
  POST {sandbox_b.hostUrl}:{sandbox_b.servicePort}/generate

  è¯·æ±‚ä½“ï¼š
  {
    "prompt": "åˆ›å»ºä¸€ä¸ª 3D æ—¶é’Ÿ...",
    "model": "claude-3-5-sonnet",
    "apiKey": "sk-xxx"  // ç”¨æˆ·è‡ªå·±çš„ Key æˆ–ä¸ä¼ ï¼ˆç”¨ç®¡ç†å‘˜çš„ï¼‰
  }

  â†’ è¿”å› generation_id
```

### 3.3 æµå¼è¿›åº¦ï¼ˆå‰ç«¯ï¼‰
```
å‰ç«¯å»ºç«‹ SSE è¿æ¥ï¼š
  GET {sandbox_a.hostUrl}:{sandbox_a.servicePort}/stream/{generation_id}
  GET {sandbox_b.hostUrl}:{sandbox_b.servicePort}/stream/{generation_id}

  â†’ æ¥æ”¶æµå¼æ•°æ®ï¼š
     data: {"status": "generating", "progress": 50, "code": "..."}
  â†’ å®æ—¶æ›´æ–° UI æ˜¾ç¤ºè¿›åº¦
```

### 3.4 é¢„è§ˆåŠ è½½
```
ç”Ÿæˆå®Œæˆ â†’ å‰ç«¯æ¥æ”¶å®Œæ•´ URL
  â†’ iframe åŠ è½½ï¼š
     sandbox_a.hostUrl:{sandbox_a.previewPort}
     sandbox_b.hostUrl:{sandbox_b.previewPort}
  â†’ ç”¨æˆ·å¯äº¤äº’é¢„è§ˆ
```

### 3.5 ç”Ÿæˆä¸­æ“ä½œ
```
ç”¨æˆ·ç‚¹å‡»"åœæ­¢" â†’ POST /api/apps/:id/stop
  â†’ è°ƒç”¨ Sandbox API é”€æ¯å®ä¾‹
  â†’ æ›´æ–° apps è¡¨çŠ¶æ€ï¼ˆå¯é€‰ï¼Œæš‚ä¸å®ç°ï¼‰

ç”¨æˆ·åˆ‡æ¢æ¨¡å‹ â†’ æç¤ºï¼š"åˆ‡æ¢æ¨¡å‹ä¼šåœæ­¢å½“å‰ç”Ÿæˆ"
  â†’ ç¡®è®¤ â†’ è°ƒç”¨ /api/apps/:id/stop
  â†’ é‡æ–°è°ƒç”¨ /api/apps/createï¼ˆæ–°çš„ Sandbox å®ä¾‹ï¼‰
```

---

## 4. å½•å±ä¸Šä¼ æµç¨‹

### 4.1 å¼€å§‹å½•åˆ¶
```
ç”¨æˆ·ç‚¹å‡»"å½•åˆ¶" â†’ MediaRecorder.start()
  â†’ å½•åˆ¶èŒƒå›´ï¼šæ•´ä¸ªæ ‡ç­¾é¡µ
  â†’ åªè¯»æç¤ºè¯æ˜¾ç¤ºåœ¨é¡¶éƒ¨ï¼ˆä½œä¸ºé™„åŠ ä¿¡æ¯ï¼‰
  â†’ æœ€å¤§æ—¶é•¿ï¼š60sï¼ˆç¡¬é™åˆ¶ï¼‰
```

### 4.2 å½•åˆ¶æ§åˆ¶
```
å½•åˆ¶ä¸­ â†’ é¡¶éƒ¨æ˜¾ç¤ºï¼š"ğŸ”´ 00:05 [â¸ æš‚åœ] [âœ“ å®Œæˆ] [âœ• å–æ¶ˆ]"
  â†’ ç”¨æˆ·ç‚¹å‡»"å®Œæˆ" â†’ MediaRecorder.stop()
  â†’ ç”Ÿæˆ WebM Blob
```

### 4.3 ç”Ÿæˆä¸Šä¼  URL
```
å‰ç«¯ POST /api/media/upload-url
  â†’ åç«¯è°ƒç”¨ Cloudflare Stream API åˆ›å»ºä¸Šä¼  URL
  â†’ è¿”å›ï¼š
     {
       uploadUrl: "https://upload.cloudflarestream.com/...",
       videoUid: "6b9e68b07dfee8cc2d116e4c51d6a957",
       previewUrl: "https://customer-{CODE}.cloudflarestream.com/6b9e68b.../watch"
     }
```

### 4.4 ä¸Šä¼ è§†é¢‘
```
å‰ç«¯ä½¿ç”¨ uploadUrl ä¸Šä¼  WebM Blob
  â†’ POST è¯·æ±‚åˆ° Cloudflare Stream
  â†’ ä¸Šä¼ å®Œæˆåï¼Œå‰ç«¯å·²çŸ¥é“ previewUrl
```

### 4.5 ç”Ÿæˆ Posterï¼ˆå¯é€‰ï¼‰
```
ç”¨æˆ·æœªå½•åˆ¶ï¼Œç›´æ¥åˆ†äº« â†’ å‰ç«¯è°ƒç”¨ html2canvas
  â†’ æˆªå–é¢„è§ˆåŒºä¸¤å¸§
  â†’ æ‹¼æ¥æˆä¸€å¼ å›¾ï¼ˆ16:9ï¼‰
  â†’ ä½œä¸º Poster ä½¿ç”¨
```

### 4.6 ä¿å­˜ URL
```
å‰ç«¯ POST /api/apps/:id/update-video-url
  â†’ åç«¯æ›´æ–° apps.preview_video_url
  â†’ è¿”å›æˆåŠŸ
```

---

## 5. åˆ†äº«éƒ¨ç½²æµç¨‹

### 5.1 æ‰“å¼€åˆ†äº«å¼¹çª—
```
å½•åˆ¶å®Œæˆ â†’ å¼¹å‡ºåˆ†äº«æ¡†
  â†’ é¢„å¡«å……åº”ç”¨åç§°ï¼ˆLLM è‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·ç¼–è¾‘ï¼‰
  â†’ æ˜¾ç¤ºè§†é¢‘é¢„è§ˆï¼ˆCloudflare Stream Playerï¼‰
  â†’ é€‰é¡¹ï¼š
     - ç¤¾äº¤åˆ†äº«ï¼ˆX, LinkedIn, TikTokï¼‰
     - å¤åˆ¶é“¾æ¥
     - å‘å¸ƒåˆ°ç”»å»Š
     - ä¸‹è½½ MP4
```

### 5.2 å¼€å§‹éƒ¨ç½²
```
ç”¨æˆ·ç‚¹å‡»"åˆ†äº«" â†’ POST /api/apps/:id/deploy
  â†’ æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆuser_id åŒ¹é…ï¼‰
  â†’ è°ƒç”¨ Sandbox çš„ Vercel éƒ¨ç½²æ¥å£ï¼š
     POST {sandbox_host_url_a}:8000/deploy
     POST {sandbox_host_url_b}:8000/deploy
  â†’ Sandbox å†…éƒ¨æ‰§è¡Œï¼švercel deploy --prod --yes
  â†’ æ›´æ–° apps.is_vercel_deploying = TRUE
  â†’ è¿”å›ï¼š"å¼€å§‹éƒ¨ç½²"
```

### 5.3 è½®è¯¢éƒ¨ç½²çŠ¶æ€
```
å‰ç«¯å¼€å§‹è½®è¯¢ â†’ GET /api/apps/:id/deploy-statusï¼ˆæ¯ 30sï¼‰
  â†’ è°ƒç”¨ Sandbox çš„çŠ¶æ€æŸ¥è¯¢æ¥å£
  â†’ è¿”å›ï¼š
     {
       status: "deploying" | "completed" | "failed",
       vercelUrlA: "https://...",
       vercelUrlB: "https://...",
       progress: 50
     }
  â†’ æ˜¾ç¤ºè¿›åº¦æ¡ï¼š"éƒ¨ç½²ä¸­... 50%"
```

### 5.4 éƒ¨ç½²å®Œæˆ
```
éƒ¨ç½²å®Œæˆ â†’ åç«¯æ›´æ–°ï¼š
  - apps.vercel_url_a, apps.vercel_url_b
  - apps.is_vercel_deploying = FALSE
  â†’ å‰ç«¯æ˜¾ç¤ºåˆ†äº«é“¾æ¥ï¼šhttps://render-areana.novita.ai/g/{appId}
  â†’ ç”¨æˆ·å¯åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“æˆ–å‘å¸ƒåˆ°ç”»å»Š
```

### 5.5 å‘å¸ƒåˆ°ç”»å»Š
```
ç”¨æˆ·å‹¾é€‰"å‘å¸ƒåˆ°ç”»å»Š" â†’ POST /api/apps/:id/publish
  â†’ æ›´æ–° apps.is_public = TRUE
  â†’ é¦–é¡µç€‘å¸ƒæµæ˜¾ç¤ºè¯¥ app
```

---

## 6. ç”»å»Šæµè§ˆæµç¨‹

### 6.1 æµè§ˆç€‘å¸ƒæµ
```
é¦–é¡µ â†’ GET /api/apps?category=latest&page=1&limit=20
  â†’ è¿”å›å…¬å¼€çš„ appsï¼ˆis_public = TRUEï¼‰
  â†’ æŒ‰åˆ›å»ºæ—¶é—´å€’åºæˆ–ç‚¹èµæ•°å€’åº
  â†’ ç€‘å¸ƒæµå¡ç‰‡æ˜¾ç¤ºï¼š
     - è§†é¢‘é¢„è§ˆæˆ– Poster
     - åº”ç”¨åç§°
     - æ¨¡å‹æ ‡ç­¾ï¼ˆClaude vs GPT-4ï¼‰
     - ç‚¹èµæ•°
```

### 6.2 æŸ¥çœ‹ App è¯¦æƒ…
```
ç”¨æˆ·ç‚¹å‡»å¡ç‰‡ â†’ è·³è½¬ /g/:appIdï¼ˆåªè¯»é¢„è§ˆé¡µé¢ï¼‰
  â†’ æŸ¥è¯¢ app ä¿¡æ¯
  â†’ æŸ¥è¯¢ 2 ä¸ª Sandbox Host URLs
  â†’ æ˜¾ç¤ºåªè¯»é¢„è§ˆï¼š
     - 2 ä¸ª iframe é¢„è§ˆ
     - åº”ç”¨ä¿¡æ¯ï¼ˆåç§°ã€æç¤ºè¯ã€æ¨¡å‹ï¼‰
     - å¦‚æœç”¨æˆ·æ˜¯ä½œè€…ï¼Œæ˜¾ç¤º"ç¼–è¾‘"æŒ‰é’®
     - ç™»å½•ç”¨æˆ·å¯ç‚¹èµ
```

### 6.3 ç‚¹èµåŠŸèƒ½
```
ç™»å½•ç”¨æˆ·ç‚¹å‡»"ç‚¹èµ" â†’ POST /api/apps/:id/like
  â†’ æ£€æŸ¥æ˜¯å¦å·²ç‚¹èµï¼ˆlikes è¡¨å”¯ä¸€çº¦æŸï¼‰
  â†’ æœªç‚¹èµ â†’ æ’å…¥ likes è¡¨ â†’ æ›´æ–° apps.like_count
  â†’ è¿”å›æ–°çš„ like_count
```

### 6.4 Fork åŠŸèƒ½
```
ç”¨æˆ·ç‚¹å‡»"å¤åˆ¶" â†’ è·³è½¬ Playground
  â†’ è‡ªåŠ¨å¡«å……åŸ app çš„ prompt å’Œæ¨¡å‹é€‰æ‹©
  â†’ ç”¨æˆ·å¯é‡æ–°ç”Ÿæˆï¼ˆæ–°çš„ Sandbox å®ä¾‹ï¼‰
  â†’ ç™»å½•é€»è¾‘ç”± Playground çš„ç”Ÿæˆ API åˆ¤æ–­
```

---

## 7. æ ¸å¿ƒçŠ¶æ€æœº

### 7.1 Playground é¡µé¢çŠ¶æ€
```
idle: ç©ºé—²ï¼Œç­‰å¾…è¾“å…¥
generating: æ­£åœ¨ç”Ÿæˆ
completed: ç”Ÿæˆå®Œæˆï¼Œå¯äº¤äº’
recording: å½•åˆ¶ä¸­
sharing: åˆ†äº«å¼¹çª—æ‰“å¼€
deploying: Vercel éƒ¨ç½²ä¸­
```

### 7.2 çŠ¶æ€è½¬æ¢
```
idle â†’ ç‚¹å‡»ç”Ÿæˆ â†’ generating
generating â†’ ç”Ÿæˆå®Œæˆ â†’ completed
completed â†’ ç‚¹å‡»å½•åˆ¶ â†’ recording
recording â†’ ç‚¹å‡»å®Œæˆ â†’ sharing
sharing â†’ ç‚¹å‡»åˆ†äº« â†’ deploying
deploying â†’ éƒ¨ç½²å®Œæˆ â†’ completedï¼ˆæˆ– back to idleï¼‰
```

### 7.3 è¾“å…¥æ§åˆ¶å°çŠ¶æ€
```
çŠ¶æ€ 1: è¾“å…¥æ—¶ï¼ˆæœªç”Ÿæˆ/é‡æ–°ç¼–è¾‘ï¼‰
  - æ˜¾ç¤ºçµæ„Ÿå¡ç‰‡ + å¤šè¡Œè¾“å…¥æ¡† + ç”ŸæˆæŒ‰é’®

çŠ¶æ€ 2: ç”Ÿæˆä¸­
  - æŠ˜å ä¸ºç®€æ´åªè¯»æ¡ï¼š"â³ æ­£åœ¨ç”Ÿæˆ... [â¹ åœæ­¢ç”Ÿæˆ]"

çŠ¶æ€ 3: ç”Ÿæˆå & æœªå½•åˆ¶
  - æŠ˜å ä¸ºæç¤ºæ¡ï¼š"âœ“ ç”Ÿæˆå®Œæˆï¼ç‚¹å‡» [ğŸ”´ å½•åˆ¶] æ•æ‰ç²¾å½©ç¬é—´"
  - ç§»è‡³é¡¶éƒ¨å¯¼èˆªæ ä¸‹æ–¹

çŠ¶æ€ 4: ç”Ÿæˆå & å½•åˆ¶ä¸­
  - åªè¯»æç¤ºè¯æ¡æ˜¾ç¤ºåœ¨é¡¶éƒ¨
  - å®Œå…¨æ”¶èµ·åº•éƒ¨è¾“å…¥æ¡†
```

---

## ç›¸å…³æ–‡æ¡£

- **æŠ€æœ¯é€‰å‹**: è¯¦è§ [00-æŠ€æœ¯é€‰å‹.md](./00-æŠ€æœ¯é€‰å‹.md)
- **æ¥å£è®¾è®¡**: è¯¦è§ [02-æ¥å£è®¾è®¡.md](./02-æ¥å£è®¾è®¡.md)
- **æ•°æ®åº“è®¾è®¡**: è¯¦è§ [03-æ•°æ®åº“è®¾è®¡.md](./03-æ•°æ®åº“è®¾è®¡.md)
